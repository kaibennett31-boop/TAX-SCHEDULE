<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Season Readiness - One-on-One Scheduler</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide React Icons as inline SVG components
        const Calendar = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const Clock = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const Video = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polygon points="23 7 16 12 23 17 23 7"></polygon>
                <rect x="1" y="5" width="15" height="14" rx="2" ry="2"></rect>
            </svg>
        );

        const CheckCircle = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );

        const AlertCircle = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        // Simple localStorage-based storage for deployment (replace with your backend if needed)
        const storage = {
            async get(key, shared = false) {
                try {
                    const value = localStorage.getItem(key);
                    return value ? { key, value, shared } : null;
                } catch (e) {
                    throw new Error('Key not found');
                }
            },
            async set(key, value, shared = false) {
                try {
                    localStorage.setItem(key, value);
                    return { key, value, shared };
                } catch (e) {
                    return null;
                }
            },
            async delete(key, shared = false) {
                try {
                    localStorage.removeItem(key);
                    return { key, deleted: true, shared };
                } catch (e) {
                    return null;
                }
            },
            async list(prefix = '', shared = false) {
                try {
                    const keys = [];
                    for (let i = 0; i < localStorage.length; i++) {
                        const key = localStorage.key(i);
                        if (key.startsWith(prefix)) {
                            keys.push(key);
                        }
                    }
                    return { keys, prefix, shared };
                } catch (e) {
                    return { keys: [], prefix, shared };
                }
            }
        };

        function AppointmentScheduler() {
            const [selectedDate, setSelectedDate] = useState('');
            const [selectedTime, setSelectedTime] = useState('');
            const [name, setName] = useState('');
            const [email, setEmail] = useState('');
            const [role, setRole] = useState('');
            const [bookings, setBookings] = useState({});
            const [loading, setLoading] = useState(true);
            const [bookingComplete, setBookingComplete] = useState(false);
            const [error, setError] = useState('');

            // IMPORTANT: Replace this with your actual Zoom link
            const ZOOM_LINK = 'https://zoom.us/j/YOUR-MEETING-ID';

            const dates = [
                { date: '2026-01-18', label: 'Saturday, January 18', times: generateTimeSlots('11:00', '17:00') },
                { date: '2026-01-19', label: 'Sunday, January 19', times: generateTimeSlots('11:00', '17:00') },
                { date: '2026-01-21', label: 'Tuesday, January 21', times: generateTimeSlots('11:00', '17:00') },
                { date: '2026-01-23', label: 'Thursday, January 23', times: generateTimeSlots('11:00', '17:00') }
            ];

            function generateTimeSlots(start, end) {
                const slots = [];
                let current = start;
                
                while (current < end) {
                    const [hours, minutes] = current.split(':');
                    const hour = parseInt(hours);
                    const ampm = hour >= 12 ? 'PM' : 'AM';
                    const displayHour = hour > 12 ? hour - 12 : (hour === 0 ? 12 : hour);
                    slots.push({
                        value: current,
                        label: `${displayHour}:${minutes} ${ampm}`
                    });
                    
                    const totalMinutes = parseInt(hours) * 60 + parseInt(minutes) + 30;
                    const newHours = Math.floor(totalMinutes / 60);
                    const newMinutes = totalMinutes % 60;
                    current = `${String(newHours).padStart(2, '0')}:${String(newMinutes).padStart(2, '0')}`;
                }
                
                return slots;
            }

            useEffect(() => {
                loadBookings();
                // Refresh bookings every 5 seconds to show real-time updates
                const interval = setInterval(loadBookings, 5000);
                return () => clearInterval(interval);
            }, []);

            async function loadBookings() {
                setLoading(true);
                try {
                    const result = await storage.list('booking:', true);
                    if (result && result.keys) {
                        const bookingData = {};
                        for (const key of result.keys) {
                            try {
                                const data = await storage.get(key, true);
                                if (data && data.value) {
                                    const parsed = JSON.parse(data.value);
                                    bookingData[key.replace('booking:', '')] = parsed;
                                }
                            } catch (e) {
                                console.log('Key not found:', key);
                            }
                        }
                        setBookings(bookingData);
                    }
                } catch (error) {
                    console.error('Error loading bookings:', error);
                }
                setLoading(false);
            }

            async function handleBooking(e) {
                e.preventDefault();
                
                if (!name || !email || !role || !selectedDate || !selectedTime) {
                    setError('Please fill in all fields and select a time slot');
                    return;
                }

                const bookingKey = `${selectedDate}_${selectedTime}`;
                
                // Check if slot is still available
                try {
                    const existing = await storage.get(`booking:${bookingKey}`, true);
                    if (existing) {
                        setError('This time slot was just booked by someone else. Please select another time.');
                        await loadBookings();
                        return;
                    }
                } catch (e) {
                    // Slot is available
                }

                // Book the slot
                try {
                    const bookingData = {
                        name,
                        email,
                        role,
                        date: selectedDate,
                        time: selectedTime,
                        bookedAt: new Date().toISOString()
                    };

                    await storage.set(`booking:${bookingKey}`, JSON.stringify(bookingData), true);
                    setBookingComplete(true);
                    await loadBookings();
                } catch (error) {
                    setError('Failed to book appointment. Please try again.');
                    console.error('Booking error:', error);
                }
            }

            function isSlotBooked(date, time) {
                return bookings[`${date}_${time}`] !== undefined;
            }

            function getBookingInfo(date, time) {
                return bookings[`${date}_${time}`];
            }

            if (loading && Object.keys(bookings).length === 0) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center">
                        <div className="text-center">
                            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600 mx-auto"></div>
                            <p className="mt-4 text-gray-600">Loading available appointments...</p>
                        </div>
                    </div>
                );
            }

            if (bookingComplete) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
                        <div className="bg-white rounded-lg shadow-xl p-8 max-w-md w-full text-center">
                            <CheckCircle className="w-16 h-16 text-green-500 mx-auto mb-4" />
                            <h2 className="text-2xl font-bold text-gray-800 mb-4">Appointment Confirmed!</h2>
                            <div className="bg-green-50 border border-green-200 rounded-lg p-4 mb-6">
                                <p className="text-gray-700 mb-2"><strong>Name:</strong> {name}</p>
                                <p className="text-gray-700 mb-2"><strong>Email:</strong> {email}</p>
                                <p className="text-gray-700 mb-2"><strong>Role:</strong> {role}</p>
                                <p className="text-gray-700 mb-2">
                                    <strong>Date:</strong> {dates.find(d => d.date === selectedDate)?.label}
                                </p>
                                <p className="text-gray-700">
                                    <strong>Time:</strong> {dates.find(d => d.date === selectedDate)?.times.find(t => t.value === selectedTime)?.label}
                                </p>
                            </div>
                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                                <div className="flex items-center justify-center mb-2">
                                    <Video className="w-5 h-5 text-blue-600 mr-2" />
                                    <h3 className="font-semibold text-gray-800">Zoom Meeting Link</h3>
                                </div>
                                <a 
                                    href={ZOOM_LINK} 
                                    target="_blank" 
                                    rel="noopener noreferrer"
                                    className="text-blue-600 hover:text-blue-800 underline break-all"
                                >
                                    {ZOOM_LINK}
                                </a>
                            </div>
                            <p className="text-sm text-gray-600 mb-4">Save this confirmation for your records.</p>
                            <button
                                onClick={() => window.location.reload()}
                                className="bg-indigo-600 text-white px-6 py-2 rounded-lg hover:bg-indigo-700 transition"
                            >
                                Book Another Appointment
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4 py-8">
                    <div className="max-w-4xl mx-auto">
                        <div className="bg-white rounded-lg shadow-xl p-8">
                            <div className="text-center mb-8">
                                <h1 className="text-3xl font-bold text-gray-800 mb-2">Tax Season Readiness</h1>
                                <h2 className="text-xl text-gray-600">One-on-One Appointment Scheduler</h2>
                                <p className="text-sm text-gray-500 mt-2">Book your session with tax preparers and ERA</p>
                            </div>

                            {error && (
                                <div className="bg-red-50 border border-red-200 rounded-lg p-4 mb-6 flex items-start">
                                    <AlertCircle className="w-5 h-5 text-red-500 mr-2 mt-0.5 flex-shrink-0" />
                                    <p className="text-red-700">{error}</p>
                                </div>
                            )}

                            <form onSubmit={handleBooking}>
                                <div className="grid md:grid-cols-2 gap-6 mb-6">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Full Name *
                                        </label>
                                        <input
                                            type="text"
                                            value={name}
                                            onChange={(e) => setName(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            placeholder="Enter your name"
                                            required
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            Email Address *
                                        </label>
                                        <input
                                            type="email"
                                            value={email}
                                            onChange={(e) => setEmail(e.target.value)}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                            placeholder="your.email@example.com"
                                            required
                                        />
                                    </div>
                                </div>

                                <div className="mb-6">
                                    <label className="block text-sm font-medium text-gray-700 mb-2">
                                        Role *
                                    </label>
                                    <select
                                        value={role}
                                        onChange={(e) => setRole(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                        required
                                    >
                                        <option value="">Select your role</option>
                                        <option value="Tax Preparer">Tax Preparer</option>
                                        <option value="ERA">ERA</option>
                                        <option value="Office Manager">Office Manager</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>

                                <div className="mb-8">
                                    <h3 className="text-lg font-semibold text-gray-800 mb-4 flex items-center">
                                        <Calendar className="w-5 h-5 mr-2" />
                                        Select Your Appointment
                                    </h3>

                                    {dates.map((dateObj) => (
                                        <div key={dateObj.date} className="mb-6">
                                            <h4 className="font-medium text-gray-700 mb-3 text-lg">{dateObj.label}</h4>
                                            <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2">
                                                {dateObj.times.map((timeSlot) => {
                                                    const isBooked = isSlotBooked(dateObj.date, timeSlot.value);
                                                    const bookingInfo = getBookingInfo(dateObj.date, timeSlot.value);
                                                    const isSelected = selectedDate === dateObj.date && selectedTime === timeSlot.value;

                                                    return (
                                                        <button
                                                            key={timeSlot.value}
                                                            type="button"
                                                            disabled={isBooked}
                                                            onClick={() => {
                                                                if (!isBooked) {
                                                                    setSelectedDate(dateObj.date);
                                                                    setSelectedTime(timeSlot.value);
                                                                    setError('');
                                                                }
                                                            }}
                                                            className={`
                                                                p-3 rounded-lg border-2 transition-all text-sm font-medium
                                                                ${isBooked 
                                                                    ? 'bg-gray-100 border-gray-300 text-gray-400 cursor-not-allowed' 
                                                                    : isSelected
                                                                        ? 'bg-indigo-600 border-indigo-600 text-white shadow-lg'
                                                                        : 'bg-white border-gray-300 text-gray-700 hover:border-indigo-400 hover:bg-indigo-50'
                                                                }
                                                            `}
                                                        >
                                                            <div className="flex items-center justify-center">
                                                                <Clock className="w-4 h-4 mr-1" />
                                                                {timeSlot.label}
                                                            </div>
                                                            {isBooked && (
                                                                <div className="text-xs mt-1 truncate" title={bookingInfo?.name}>
                                                                    Booked
                                                                </div>
                                                            )}
                                                        </button>
                                                    );
                                                })}
                                            </div>
                                        </div>
                                    ))}
                                </div>

                                <div className="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                                    <p className="text-sm text-gray-700">
                                        <strong>Note:</strong> Once you book a time slot, it will be reserved exclusively for you and others will not be able to select it. You will receive the Zoom meeting link immediately after booking.
                                    </p>
                                </div>

                                <button
                                    type="submit"
                                    disabled={!selectedDate || !selectedTime || !name || !email || !role}
                                    className="w-full bg-indigo-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-indigo-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-xl"
                                >
                                    Confirm Appointment
                                </button>
                            </form>
                        </div>

                        <div className="mt-6 text-center text-sm text-gray-600">
                            <p>Questions? Contact the scheduling coordinator</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<AppointmentScheduler />, document.getElementById('root'));
    </script>
</body>
</html>